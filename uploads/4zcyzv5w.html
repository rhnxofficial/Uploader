<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RHNX CDN Uploader</title>

  <!-- FONT -->
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <!-- TAILWIND -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          fontFamily: {
            mono: ['"Share Tech Mono"', 'monospace']
          },
          backgroundImage: {
            'gradient-primary': 'linear-gradient(to bottom, #3db8f5, #1473e6)',
            'gradient-red': 'linear-gradient(to bottom, #f87171, #dc2626)'
          }
        }
      }
    }
  </script>
</head>

<body class="bg-slate-900 min-h-screen flex items-center justify-center font-mono text-white px-3">

<div class="bg-slate-800/80 backdrop-blur p-5 sm:p-6 rounded-2xl w-full max-w-md border border-slate-700 shadow-xl">

  <!-- HEADER -->
  <h1 class="text-xl sm:text-2xl font-bold text-center mb-1">
    RHNX CDN Uploader
  </h1>
  <p class="text-center text-slate-400 text-xs sm:text-sm mb-5">
    Upload file → get CDN URL
  </p>

  <!-- FILE INPUT -->
  <label class="block mb-4">
    <span class="text-xs text-slate-300">Pilih File</span>
    <input type="file" id="file"
      class="mt-1 w-full text-xs sm:text-sm
      file:mr-3 file:py-2 file:px-3
      file:rounded-lg file:border-0
      file:bg-gradient-primary file:text-white
      hover:file:opacity-90 cursor-pointer" />
  </label>

  <!-- EXPIRE SELECT -->
  <label class="block mb-4">
    <span class="text-xs text-slate-300">Waktu Penyimpanan</span>
    <select id="expire"
      class="mt-1 w-full bg-slate-900 border border-slate-700 rounded-lg px-3 py-2 text-xs sm:text-sm">
      <option value="30">⏱️ 30 Detik (Auto Hapus)</option>
      <option value="permanent">♾️ Selamanya</option>
    </select>
  </label>

<button id="uploadBtn" onclick="upload()"
  class="w-full py-2 rounded-xl bg-gradient-primary font-bold tracking-wide
  hover:opacity-90 transition flex items-center justify-center gap-2">
  
  <svg id="spinner" class="hidden w-4 h-4 animate-spin" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10" stroke="white" stroke-width="4" fill="none" opacity="0.25"/>
    <path d="M22 12a10 10 0 0 1-10 10" stroke="white" stroke-width="4" fill="none"/>
  </svg>

  <span id="btnText">UPLOAD</span>
</button>
 

  <!-- RESULT -->
  <div id="resultBox" class="hidden mt-4 bg-slate-900 border border-slate-700 rounded-xl p-3">
  <p class="text-xs text-slate-400 mb-1">Result URL</p>

  <input id="resultUrl" readonly
    class="w-full bg-transparent text-xs break-all focus:outline-none mb-2"/>

  <div class="flex justify-between items-center gap-2">
    <span id="timer" class="text-xs text-red-400 hidden"></span>

    <div class="flex gap-2">
      <button onclick="resetUI()"
        class="px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs">
        ⟳
      </button>

      <button onclick="copyUrl()"
        class="px-3 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs">
        COPY
      </button>
    </div>
  </div>
</div>

<script>
let countdownInterval;

async function upload() {
  const fileInput = document.getElementById("file");
  const file = fileInput.files[0];
  const expire = document.getElementById("expire").value;

  if (!file) return alert("Pilih file dulu");

  setLoading(true);

  const form = new FormData();
  form.append("file", file);
  form.append("expire", expire);

  try {
    const res = await fetch("/upload", { method: "POST", body: form });
    const json = await res.json();

    if (!json.url) throw new Error("Upload gagal");

    document.getElementById("resultBox").classList.remove("hidden");
    document.getElementById("resultUrl").value = json.url;

    if (expire === "30") {
      startTimer(Date.now() + 30 * 1000);
    }
  } catch (err) {
    alert(err.message || "Upload error");
  } finally {
    setLoading(false);
  }
}

function setLoading(state) {
  const btn = document.getElementById("uploadBtn");
  const spinner = document.getElementById("spinner");
  const text = document.getElementById("btnText");

  btn.disabled = state;
  btn.classList.toggle("opacity-60", state);
  btn.classList.toggle("cursor-not-allowed", state);

  spinner.classList.toggle("hidden", !state);
  text.textContent = state ? "UPLOADING..." : "UPLOAD";
}

function startTimer(expiresAt) {
  const timerEl = document.getElementById("timer");
  timerEl.classList.remove("hidden");

  clearInterval(countdownInterval);

  countdownInterval = setInterval(() => {
    const diff = Math.max(0, Math.floor((expiresAt - Date.now()) / 1000));

    timerEl.textContent =
      diff > 0
        ? `⏳ Auto delete dalam ${diff} detik`
        : "❌ File sudah dihapus";

    if (diff <= 0) clearInterval(countdownInterval);
  }, 1000);
}

function resetUI() {
  clearInterval(countdownInterval);

  document.getElementById("file").value = "";
  document.getElementById("resultBox").classList.add("hidden");
  document.getElementById("timer").classList.add("hidden");
}

function copyUrl() {
  const input = document.getElementById("resultUrl");
  input.select();
  document.execCommand("copy");
}
</script>

</body>
</html>